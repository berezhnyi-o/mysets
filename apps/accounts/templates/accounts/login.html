{% extends "accounts/base_auth.html" %}
{% load i18n core_tags staticfiles %}

{% block title %}{% trans "Login" %}{% endblock %}



{#{% block header_classes %}u-header--abs-top-md u-header--show-hide-md{% endblock %}#}
{#{% block container_classes %}u-bg-light-blue-50{% endblock %}#}

{% block body_top %}
{% if request.user.is_anonymous %}
{% if GOOGLE_CLIENT_ID %}
<script src="https://apis.google.com/js/platform.js?onload=start" async defer></script>
<script>
function start() {
  gapi.load('auth2', function() {
    auth2 = gapi.auth2.init({
      client_id: '{{GOOGLE_CLIENT_ID}}',
      // Scopes to request in addition to 'profile' and 'email'
      cookiepolicy: 'single_host_origin',
      scope: 'profile'
    });
  });
}

function signInCallback(authResult) {
  if (authResult['code']) {

    // Hide the sign-in button now that the user is authorized, for example:
    $('#__action--gg-login').attr('style', 'display: none');

    // Send the code to the server
    $.ajax({
      type: 'POST',
      url: '{% url "gg_login" %}',
      // Always include an `X-Requested-With` header in every AJAX request,
      // to protect against CSRF attacks.
      headers: {
        'X-Requested-With': 'XMLHttpRequest'
      },
      contentType: 'application/octet-stream; charset=utf-8',
      success: function(result) {
        window.location = result.redirect_url;
      },
      processData: false,
      data: authResult['code']
    });
  } else {
    // There was an error.
  }
}

$(document).ready(function() {
    $("#__action--gg-login").click(function () {
        auth2.grantOfflineAccess().then(signInCallback);
    });
});
</script>
{% endif %}
{% if FACEBOOK_APP_ID %}
<script>
window.fbAsyncInit = function() {
  FB.init({
    appId: '{{FACEBOOK_APP_ID}}',
    xfbml: true,
    status: true,
    cookie: true,
    version: 'v{{FACEBOOK_API_VERSION}}'
  });
};

(function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "https://connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));

$(document).ready(function() {
    $("#__action--fb-login").click(function() {
        // FB.login(function(){}, {scope: 'publish_actions'});
        FB.login(function(response) {
          // console.log(JSON.stringify(response));
          if(response.status === "connected") {
            window.location.href = "{% url 'fb_login' %}";
          }
        }, {scope: "email"});
    });
});
</script>
{% endif %}
{% endif %}
{% endblock %}

{% block content %}
<header id="auth-header" class="auth-header" style="background-image: url({% static 'manage/images/illustration/img-1.png' %});">
<h1>
  <img src="{% static 'tabbli-logo-inverse-4.png' %}" alt="" height="72"> <span class="sr-only">{% trans "Sign In" %}</span>
</h1>
<p> <!-- {% trans "Don't have a account?" %} <a href="{% url 'register' %}">{% trans "Create One" %}</a> -->
</p>
</header><!-- form -->
<form method="post" class="{% if not request.META.HTTP_USER_AGENT|endswith:"Tabbli iOS" %}__action--ajax-submit{% endif %} auth-form" data-target="#login-form-body">
    <div id="login-form-body">{% include "accounts/includes/login_form.html" %}</div>
    <!-- .form-group -->
    {#        <div class="form-group text-center">#}
    {#          <div class="custom-control custom-control-inline custom-checkbox">#}
    {#            <input type="checkbox" class="custom-control-input" id="remember-me"> <label class="custom-control-label" for="remember-me">Keep me sign in</label>#}
    {#          </div>#}
    {#        </div><!-- /.form-group -->#}
    <!-- recovery links -->
    {% if not request.META.HTTP_USER_AGENT|endswith:"Tabbli iOS" %}
    <div class="text-center pt-3">
      <a href="{% url 'password_reset' %}" rel="nofollow" class="link">{% trans "Forgot Password?" %}</a>
    </div><!-- /recovery links -->
    {% endif %}
</form><!-- /.auth-form -->

{#<div class="container u-space-3">#}
{#<div class="row">#}
{#<div class="col-md-6 offset-md-3 bg-white shadow">#}
{#<div class="mb-4">#}
{#<h1 class="h2 font-weight-normal mt-4">{% trans "Login" %}</h1>#}
{#<div class="row mb-4 mt-2">#}
{#    <div class="col-6">#}
{#        {% if FACEBOOK_APP_ID %}#}
{#        <a id="__action--fb-login" class="__action-link btn btn-block btn-brand btn-facebook"><i class="fab fa-facebook-square"></i> Facebook</a>#}
{#        {% endif %}#}
{#    </div>#}
{#    <div class="col-6">#}
{#        {% if GOOGLE_CLIENT_ID %}#}
{#        <a id="__action--gg-login" class="__action-link btn btn-block btn-brand btn-google-plus"><i class="fab fa-google"></i> Google</a>#}
{#        {% endif %}#}
{#    </div>#}
{#</div>#}
{#<form method="post">#}
{#    <input type="hidden" name="next" value="{{ next }}" />#}
{#    {% csrf_token %}#}
{#    {% if form.errors %}#}
{#    <div class="alert alert-danger">{% trans "The email address and password you entered do not match. Please try again." %}</div>#}
{#    {% endif %}#}
{#    {% include "forms/form_fields.html" %}#}
{##}
{#    <div class="form-group">#}
{#        <button class="btn btn-success btn-lg transition-3d-hover" type="submit">{% trans "Login" %}</button>#}
{#        <a class="btn btn-alt btn-lg" href="{% url 'register' %}" rel="nofollow">{% trans "Register" %}</a>#}
{#    </div>#}
{#    <hr>#}
{#    <div class="text-right">#}
{#        <small><a href="{% url 'password_reset' %}" rel="nofollow">{% trans "Forgotten your password?" %}</a></small>#}
{#    </div>#}
{#</form>#}
{#</div>#}
{#</div>#}
{#</div>#}
{#</div>#}
{% endblock %}